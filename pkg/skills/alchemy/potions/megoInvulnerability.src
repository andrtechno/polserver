use os;
use uo;
use util;
use cfgfile;
include ":alchemy:drinkPotion";
include "include/canAccess";
//include "include/statMod";
include ":timedScripts:timedScripts";

program drink_megoInvulnerability(who, potion)
    EraseObjProperty(who, "IsMeditating");
    EraseObjProperty(who, "HealTimer");
    if(!can_access(who, potion))
        return;
    endif
    if(potion.movable == 0)
        SendSysMessage(who, "You cannot drink that.");
        return;
    endif
    if(!CheckToDrink(who, "MegoInvulnerability"))
        return;
    endif
	if ( GetObjProperty(who, "MegoInvulnerabilityPotion") )
		SendSysMessage(who, "You are already under the influence.");
		return 0;
	endif

    case(potion.objtype)
        0x2DC26:
            empty_bottle(who, potion);
            TS_StartTimer(who, "MegoInvulnerabilityPotion", 60, 10, who);
        0x2DC27:
            empty_bottle(who, potion);
            TS_StartTimer(who, "MegoInvulnerabilityPotion", 120, 20, who);
        0x2DC28:
            empty_bottle(who, potion);
            TS_StartTimer(who, "MegoInvulnerabilityPotion", 180, 30, who);
    endcase
	PlaySoundEffect( who,  SOUND_EFFECT_HEAL );
	PlayObjectCenteredEffect(who, EFFECT_BLUE_SPARKLE, 10,10);
    SendSysMessage(who, "MegoInvulnerability.");
endprogram