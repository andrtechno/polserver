use uo;
use os;


include ":charclasses:classes";
include ":attributes:attributeConstants";
include ":attributes:attributes";

include ":attributes:skills";
include "include/skillLists";

program textcmd_setclass(who, text)

	SendSysMessage( who, "Select a character." );
	var on := Target(who,TGTOPT_CHECK_LOS);
	if(!on)
        SendSysMessage( who, "Cancelled." );
	endif

    var content:=SplitWords(text);
	var classid;
	var cname:=lower(content[1]);
	var level:=CInt(content[2]);
    var rate:=AVERAGE_SKILL;
    level:=level - 1;
    if(level > 6)
        level:=1;
    endif

	if(cname == "bard")
	    classid:=ID_BARD;
	elseif (cname == "mage")
        classid:=ID_MAGE;
    elseif (cname == "fighter")
        classid:=ID_WARRIOR;
    elseif (cname == "thief")
        classid:=ID_THIEF;
    elseif (cname == "crafter")
        classid:=ID_CRAFTER;
    elseif (cname == "ranger")
        classid:=ID_RANGER;
	endif


    if(level < 6)
        rate:=CInt( (AVERAGE_SKILL + (AVERAGE_LEVEL_MOD * level)) );
    endif;


    var cap_array := {};

    //set all skill to "0"
	foreach classe in GetClasseIds()
		foreach sid in GetClasseSkills( classe )
		    if(classid != classe)
    	        AP_SetTrueSkill( on, FindSkillName(sid), 0 );
    	        cap_array[sid+1] := 0;
    	    else
                AP_SetTrueSkill( on, FindSkillName(sid), rate );
                cap_array[sid+1] := AP_GetSkillsCap();
    	    endif
    	endforeach
	endforeach

    SetObjProperty( on, "SkillCaps", cap_array );


endprogram
