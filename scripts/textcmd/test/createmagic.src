use os;
use uo;

include "include/startEqp";
include ":gumps:gumps";
include ":gumps:gumps_ex";

//var magicadjustment := 0;

program textcmd_createmagic(who, text)
    var x := 15;
    var y := 15;
	var gump := GFCreateGump( 20, 50 );
	GFPage( gump, 1 );
	var widthGump := 300;
    var heightGump := 400;
	GFResizePic( gump, 0, 0, GFGetCfgConst("Defaults", "ForeGround"), widthGump, heightGump);
    GFTextLine(gump, 75, y, 33, "Create MagicItem Menu" );

    var types := {
        struct{id := WEAPON, name := "Weapon"},
        struct{id := ARMOR, name := "Armor"},
        struct{id := SHIELD, name := "Shield"},
        struct{id := CLOTHING, name := "Clothing"},
        struct{id := PROF, name := "Prof"},
        struct{id := MISC, name := "Misc"}
    };


	GFSetRadioGroup(gump, 1);

    y+=35;
    var index := 1;
    foreach type in types
        var name := type.name+""+type.id;
        GFRadioButton( gump, x, y, 208, 209, 0, type.id );
        GFTextLine(gump, x + 25, y, 2100, name );
        y+=20;
        index+=1;
    endforeach



    y+=15;
    GFTextLine(gump, 150, y, 2100, "Magic Level (magicadjustment):" );
    GFResizePic(gump, 150, y +25, 2620, 130, 30);
    var crafted := GFTextEntry(gump, 150 + 8, y + 30, 135, 20, 2100, "6", 400);

	GFAddButton(gump, (widthGump / 2) - 30, heightGump - 35, 247, 248, GF_CLOSE_BTN, 1);


    var input := GFSendGump( who, gump );
    var it := "robe";
    var keyid;
    foreach key in ( input.keys )
        if( key >= 4 || key <= 6 )

            if(key == 1)
                it := "VikingSword";
                keyid := key;
            elseif(key == 2)
                it := "PlateHelm";
                keyid := key;
            elseif(key == 3)
                it := "HeaterShield";
                keyid := key;
            elseif(key == 4)
                it := "Robe";
                keyid := key;
            elseif(key == 5)
                it := "bracelet";
                keyid := key;
            elseif(key == 6)
                it := "bracelet";
                keyid := key;
            endif
        endif
        SleepMS(1);

    endforeach

    var item := CreateItemInInventory( who.backpack, it, 1 );
    magicadjustment := CInt(GFExtractData(input, 400));
    //print("magicadjustment "+magicadjustment);
    //print("keyid "+keyid);
    ApplyMagic(who, item, magicadjustment, keyid);




    return 1;
    magicadjustment := 10;
    //var it := text;
    if(!it)
    //    it := "robe";
    endif
    //var item := CreateItemInInventory( who.backpack, it, 1 );


    ApplyEnchant(who, item);

    //ApplyARMod(item);
    //ApplyMiscSkillMod(item);
    //ApplyProtection( item );
    ApplyElementalImmunity( item );
    //ApplyStatMod( item );
    //ApplyHPMod( item );
    //ApplyWeapSkillMod( item );
    //ApplyDmgMod( item );


    AddName( item );
    AddRandomColor( item );

endprogram
